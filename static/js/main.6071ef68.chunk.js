(this["webpackJsonptemplate-task"]=this["webpackJsonptemplate-task"]||[]).push([[0],{106:function(e,t,a){e.exports=a(135)},134:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff"}},135:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(8),c=a.n(o),i=a(17),s=a(22),l=a(21),u=a(166),d=a(181),m=a(170),f=a(10),g=a(34),p=new(a(83).a)("db");p.version(1).stores({user:"user",tasks:"_id",challenges:"_id"}),p.on("populate",(function(){p.user.add({user:"singleUserId",_id:null}),p.tasks.bulkAdd([]),p.challenges.bulkAdd([])}));var h=function(e){return p.user.put({user:"singleUserId",_id:e}).then((function(){return!0})).catch((function(e){return console.log(e)}))},b=function(e,t,a,n){return p.tasks.update(e,{report:t,images:Object(g.a)(a),state:n})},y=a(30),k=Object(y.b)({name:"user",initialState:{isLogin:!1,user:null},reducers:{logIn:function(e,t){e.isLogin=!0},logOut:function(e){e.isLogin=!1},updateUser:function(e,t){e.user=t.payload}}}),v=k.actions,E=v.logIn,_=(v.logOut,v.updateUser),O=k.reducer,j=a(25),x=a.n(j),T=function(){return navigator.onLine?x.a.get("/challenges").then((function(e){return 200===e.status&&e.data})).catch((function(e){return!1})):p.challenges.get().toArray()},L=function(e){return navigator.onLine?x.a.get("tasks/user/".concat(e)).then((function(e){return 200===e.status&&e.data})).catch((function(e){return!1})):p.tasks.get().toArray()},S=function(e){return x.a.put("tasks/",e).then((function(e){return 200===e.status&&e.data})).catch((function(e){return!1}))},D=a(47),w=a.n(D),I=function(){var e=Object(f.b)(),t=Object(n.useState)({name:"",code:""}),a=Object(i.a)(t,2),o=a[0],c=a[1],g=Object(n.useState)({}),p=Object(i.a)(g,2),b=p[0],y=p[1],k=function(e,t){c(Object(l.a)(Object(l.a)({},o),{},Object(s.a)({},t,e.target.value)))};return r.a.createElement("div",{className:w.a.background},r.a.createElement(u.a,{className:"login-title"},"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443"),r.a.createElement("form",null,r.a.createElement(d.a,{className:w.a.loginInput,color:"secondary",id:"login-name",label:"\u041b\u043e\u0433\u0438\u043d",onChange:function(e){return k(e,"name")},error:Boolean(b.name),value:o.name,helperText:Boolean(b.name)&&"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043b\u043e\u0433\u0438\u043d"}),r.a.createElement(d.a,{className:w.a.loginInput,color:"secondary",id:"login-code",label:"\u041f\u0430\u0440\u043e\u043b\u044c",type:"password",onChange:function(e){return k(e,"code")},error:Boolean(b.code),value:o.code,helperText:Boolean(b.code)&&"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043f\u0430\u0440\u043e\u043b\u044c"}),r.a.createElement(m.a,{type:"submit",onClick:function(t){t.preventDefault();var a={};Object.entries(o).map((function(e){""===e[1]&&(a[e[0]]=!0)})),Object.keys(a).length>0?y(a):(y(a),function(e){var t=e.name,a=e.code;return x.a.get("/users").then((function(e){if(200===e.status){var n=e.data.find((function(e){return e.name===t&&e.code===a}));return n||!1}return!1})).catch((function(e){return!1}))}(o).then((function(t){t?(h(t._id),e(_(t)),e(E())):y({name:!0,code:!0})})))},className:w.a.loginButton,variant:"contained"},"\u0412\u043e\u0439\u0442\u0438")))},M=a(87),N=a.n(M),B=function(){return r.a.createElement("div",{className:N.a.background},r.a.createElement(I,null))},C=a(62),F=a(12),P=function(e){var t=e.component,a=e.restricted,n=Object(C.a)(e,["component","restricted"]),o=Object(f.c)((function(e){return e.user.isLogin}));return r.a.createElement(F.b,Object.assign({},n,{render:function(e){return o&&a?r.a.createElement(F.a,{to:"/tasks"}):r.a.createElement(t,e)}}))},R=function(e){var t=e.component,a=e.page,n=Object(C.a)(e,["component","page"]),o=Object(f.c)((function(e){return e.user.isLogin}));return r.a.createElement(F.b,Object.assign({},n,{render:function(e){return o?r.a.createElement(t,Object.assign({page:a},e)):r.a.createElement(F.a,{to:"/login"})}}))},U=Object(y.b)({name:"challenges",initialState:{items:[]},reducers:{update:function(e,t){var a;e.items=Object(g.a)(t.payload),a=t.payload,p.challenges.clear(),p.challenges.bulkPut(Object(g.a)(a))}}}),W=U.actions.update,A=U.reducer,J=a(171),H=a(174),Z=a(173),G=a(172),X=a(56),Y=a.n(X),q=Object(y.b)({name:"tasks",initialState:{elements:[]},reducers:{addTask:function(e,t){var a;e.elements=[].concat(Object(g.a)(e.elements),[t.payload]),a=t.payload,p.tasks.put(a)},updateTasks:function(e,t){var a;e.elements=t.payload,a=t.payload,p.tasks.clear(),p.tasks.bulkPut(Object(g.a)(a))},updateReport:function(e,t){var a=t.payload,n=a._id,r=a.report,o=a.images,c=e.elements.find((function(e){return e._id===n}));c&&(c.report=r,c.images=o,b(n,r,o,c.state))},updateTaskState:function(e,t){var a=e.elements.find((function(e){return e._id===t.payload._id}));a&&(a.state=t.payload.state,b(a._id,a.report,a.images,a.state))}}}),z=q.actions,V=(z.toggleEditForm,z.updateTasks),$=z.addTask,K=z.updateReport,Q=z.updateTaskState,ee=q.reducer,te=function(e){var t=e.data,a=Object(f.b)(),n=Object(f.c)((function(e){return e.user.user._id})),o=Object(f.c)((function(e){return e.tasks.elements.map((function(e){if("Cancelled"!==e.state)return e.challenge._id}))}));return r.a.createElement(J.a,{className:Y.a.background},r.a.createElement(G.a,{component:"img",alt:"task image",height:"180",image:t.image,title:"Task"}),r.a.createElement(Z.a,null,r.a.createElement(u.a,{color:"textSecondary",gutterBottom:!0,variant:"h6",component:"h2"},t.title),r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},t.description),r.a.createElement("div",{className:Y.a.challengeInfo},r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},"\u041e\u0447\u043a\u0438: ".concat(t.maxScore)),r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},"\u0418\u0441\u0442\u0435\u043a\u0430\u0435\u0442: ".concat(function(e){var t=new Date(e);return"".concat(t.getDate(),"-").concat(t.getMonth()+1,"-").concat(t.getFullYear())}(t.finishDate))))),r.a.createElement(H.a,null,r.a.createElement(m.a,{onClick:function(){(function(e){return x.a.post("challenges/accept",e).then((function(e){return 201===e.status&&e.data})).catch((function(e){return!1}))})({challengeId:t._id,userId:n}).then((function(e){e?a($(Object(l.a)(Object(l.a)({},e),{},{score:0,challenge:t,report:"",images:[]}))):console.log("err to add task")}))},className:Y.a.acceptButton,variant:"contained",color:"secondary",disabled:-1!==o.indexOf(t._id)},-1===o.indexOf(t._id)?"\u041f\u0440\u0438\u043d\u044f\u0442\u044c \u0447\u0435\u043b\u0435\u043d\u0434\u0436":"\u0412\u044b \u0443\u0436\u0435 \u0432\u0437\u044f\u043b\u0438 \u044d\u0442\u043e\u0442 \u0447\u0435\u043b\u0435\u043d\u0434\u0436")))},ae=a(175),ne=a(88),re=a.n(ne),oe=function(){return r.a.createElement("div",{className:re.a.loadingContainer},r.a.createElement(ae.a,{color:"secondary"}))},ce=a(89),ie=a.n(ce),se=function(){var e=Object(f.b)();Object(n.useEffect)((function(){T().then((function(t){e(W(t))}))}),[]);var t=Object(f.c)((function(e){return e.challenges.items}));return r.a.createElement("div",{className:ie.a.background},t.length?r.a.createElement(r.a.Fragment,null,t.map((function(e){return r.a.createElement(te,{data:e,key:e._id})}))):r.a.createElement(oe,null))},le=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(se,null))},ue=a(40),de=a(26),me=a.n(de),fe=a(3),ge=a(90),pe=a.n(ge),he=a(176),be=a(177),ye=function(e){var t=e.data,a=Object(n.useState)({InProgress:"\u0412 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f",Moderation:"\u041f\u0440\u043e\u0432\u0435\u0440\u044f\u0435\u0442\u0441\u044f \u043c\u043e\u0434\u0435\u0440\u0430\u0446\u0438\u0435\u0439",Confirmed:"\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d",Declined:"\u041f\u0440\u043e\u0432\u0430\u043b\u0435\u043d",Cancelled:"\u041e\u0442\u043c\u0435\u043d\u0435\u043d"}),o=Object(i.a)(a,1)[0],c=Object(f.b)(),g=Object(n.useState)(t.report||!1),p=Object(i.a)(g,2),h=p[0],b=p[1],y=Object(n.useState)(!1),k=Object(i.a)(y,2),v=k[0],E=k[1],_=Object(n.useState)({_id:t._id,report:t.report,images:["test"]}),O=Object(i.a)(_,2),j=O[0],x=O[1],T=Object(n.useState)({report:!1,images:!1}),L=Object(i.a)(T,2),D=L[0],w=L[1],I=function(e){var a={_id:t._id,userId:t.user,challengeId:t.challenge._id,state:e,report:t.report,images:t.images,score:t.score};"Cancelled"===e&&(a.report="",a.imagex=[],x(Object(l.a)(Object(l.a)({},j),{},{report:"",images:[]}))),E(!1),c(Q(a)),S(a).then((function(e){e?(E(!1),c(Q(e))):console.log("task doesnt update")}))},M=function(){var e={};return Object.keys(j).map((function(t){return 0===j[t].length?(e[t]=!0,!0):(e[t]=!1,!1)})).find((function(e){return!0===e}))?(w(e),!0):(w(e),!1)};return r.a.createElement(J.a,{className:me.a.background},r.a.createElement(G.a,{component:"img",alt:"task image",height:"180",image:t.challenge.image,title:"Task"}),r.a.createElement(Z.a,null,r.a.createElement(u.a,{color:"textSecondary",gutterBottom:!0,variant:"h6",component:"h2"},t.challenge.title),r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},t.challenge.description),r.a.createElement("div",{className:me.a.challengeInfo},r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u0431\u0430\u043b: ".concat(t.challenge.maxScore)),r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},"\u0422\u0432\u043e\u0439 \u0431\u0430\u043b: ".concat(t.score)),r.a.createElement(u.a,{variant:"body2",color:"textSecondary",component:"p"},"\u0418\u0441\u0442\u0435\u043a\u0430\u0435\u0442: ".concat(function(e){var t=new Date(e);return"".concat(t.getDate(),"-").concat(t.getMonth()+1,"-").concat(t.getFullYear())}(t.challenge.finishDate))))),r.a.createElement(H.a,null,r.a.createElement(m.a,{disabled:"InProgress"!==t.state||!t.report||!t.images||0===t.report.length||0===t.images.length,onClick:function(){return I("Moderation")},className:me.a.acceptButton,variant:"contained",color:"secondary"},"InProgress"!==t.state?"".concat(o[t.state]):"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044c \u0447\u0435\u043b\u043b\u0435\u043d\u0434\u0436"),r.a.createElement(he.a,{className:Object(fe.a)(me.a.expand,Object(s.a)({},me.a.expandOpen,v)),onClick:function(){v||x({_id:t._id,report:t.report,images:["test"]}),E(!v)},"aria-expanded":v,"aria-label":"show more"},r.a.createElement(pe.a,null))),r.a.createElement(be.a,{in:v,timeout:"auto",unmountOnExit:!0},r.a.createElement(Z.a,{className:me.a.reportBackground},r.a.createElement(d.a,{disabled:"InProgress"!==t.state,color:"secondary",id:"task-report",label:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",multiline:!0,onChange:function(e){return t=e,a="report",x(Object(l.a)(Object(l.a)({},j),{},Object(s.a)({},a,t.target.value))),void b(!1);var t,a},error:D.report,value:j.report,helperText:D.report&&"\u041f\u043e\u043b\u0435 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c"}),r.a.createElement(m.a,{onClick:function(){if(M())console.log("errors");else{var e={_id:t._id,userId:t.user,challengeId:t.challenge._id,state:t.state,report:j.report,images:j.images,score:t.score};c(K(j)),b(!0),S(e).then((function(e){e?(c(K(j)),b(!0)):console.log("task doesnt update")}))}},className:me.a.saveReportButton,variant:"contained",color:"secondary",disabled:h||"InProgress"!==t.state},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),r.a.createElement(m.a,{size:"small",onClick:function(){return I("Cancelled")},className:me.a.saveReportButton,variant:"outlined",color:"secondary",disabled:"InProgress"!==t.state},"\u041e\u0442\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f \u043e\u0442 \u0447\u0435\u043b\u0435\u043d\u0434\u0436\u0430"))))},ke=a(91),ve=a.n(ke),Ee=function(){var e=Object(f.c)((function(e){return e.tasks.elements})),t=Object(f.c)((function(e){return e.user.user._id})),a=Object(f.b)();return Object(n.useEffect)((function(){L(t).then((function(e){e&&a(V(e))}))}),[]),r.a.createElement("div",{className:ve.a.background},e.length?r.a.createElement(r.a.Fragment,null,e.map((function(e){return r.a.createElement(ye,{data:e,key:e._id})}))):r.a.createElement(oe,null))},_e=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ee,null))},Oe=a(178),je=a(179),xe=a(92),Te=a.n(xe),Le=a(93),Se=a.n(Le),De=a(43),we=a.n(De),Ie=function(){var e=Object(n.useState)("tasks"),t=Object(i.a)(e,2),a=t[0],o=t[1];return r.a.createElement(Oe.a,{className:we.a.background,showLabels:!0,value:a,onChange:function(e,t){o(t)}},r.a.createElement(je.a,{className:Object(fe.a)(we.a.item,Object(s.a)({},we.a.selected,"challenges"===a)),label:"\u0427\u0435\u043b\u0435\u043d\u0434\u0436\u0438",value:"challenges",icon:r.a.createElement(Te.a,null),component:ue.b,to:"/challenges"}),r.a.createElement(je.a,{className:Object(fe.a)(we.a.item,Object(s.a)({},we.a.selected,"tasks"===a)),label:"\u0417\u0430\u0434\u0430\u043d\u0438\u044f",value:"tasks",icon:r.a.createElement(Se.a,null),component:ue.b,to:"/tasks"}))},Me=function(e){var t=e.page;return r.a.createElement(r.a.Fragment,null,r.a.createElement(t,null),r.a.createElement(Ie,null))},Ne=function(){var e=Object(f.c)((function(e){return e.user.isLogin})),t=Object(f.c)((function(e){return e.user.user&&e.user.user._id})),a=Object(n.useState)(!0),o=Object(i.a)(a,2),c=o[0],s=o[1],l=Object(f.b)();return Object(n.useEffect)((function(){e&&(T().then((function(e){l(W(e))})),L(t).then((function(e){e&&l(V(e))})))}),[e]),Object(n.useEffect)((function(){p.user.get("singleUserId").then((function(e){return e._id})).catch((function(e){console.log(e)})).then((function(e){e?function(e){return x.a.get("/users/".concat(e)).then((function(e){return 200===e.status&&e.data})).catch((function(e){return!1}))}(e).then((function(e){e?(l(_(e)),l(E()),s(!1)):(h(null),s(!1))})):s(!1)}))}),[e]),c?r.a.createElement(oe,null):r.a.createElement(ue.a,null,r.a.createElement(F.d,null,r.a.createElement(P,{restricted:!0,component:B,path:"/login",exact:!0}),r.a.createElement(R,{component:Me,page:_e,path:"/tasks",exact:!0}),r.a.createElement(R,{component:Me,page:le,path:"/challenges",exact:!0}),r.a.createElement(F.a,{to:"/login"})))},Be=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ce(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Fe=Object(y.a)({reducer:{tasks:ee,user:O,challenges:A}}),Pe=a(27),Re=a.n(Pe),Ue=(a(134),a(94)),We=a(182),Ae=a(180);x.a.defaults.baseURL="https://f1f45c525785.ngrok.io";var Je=Object(Ue.a)({palette:{primary:{light:Re.a.primaryLight,main:Re.a.primaryMain,dark:Re.a.primaryDark,contrastText:Re.a.primaryText},secondary:{light:Re.a.secondaryLight,main:Re.a.secondaryMain,dark:Re.a.secondaryDark,contrastText:Re.a.secondaryText}},typography:{fontFamily:["Open Sans","Roboto","Arial"].join(",")}});!function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/sw.js");Be?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ce(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("Work on localhost")}))):Ce(t,e)}))}}(),c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(f.a,{store:Fe},r.a.createElement(We.b,{injectFirst:!0},r.a.createElement(Ae.a,{theme:Je},r.a.createElement(Ne,null))))),document.getElementById("root")),Notification.requestPermission((function(e){console.log("Notification permission status:",e)}))},26:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"Task_background__2SXkR",challengeInfo:"Task_challengeInfo__3R8B9",acceptButton:"Task_acceptButton__3sb7G",expand:"Task_expand__1af3O",expandOpen:"Task_expandOpen__1PJfp",reportBackground:"Task_reportBackground__2cDS2",saveReportButton:"Task_saveReportButton__2kpFG"}},27:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff"}},43:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"Menu_background__1EcTJ",item:"Menu_item__1WHbu"}},47:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"LoginForm_background__2j78L",loginInput:"LoginForm_loginInput__3HSUu",loginButton:"LoginForm_loginButton__1ZTv0"}},56:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"Challenge_background__3LPUE",challengeInfo:"Challenge_challengeInfo__3ywmc",acceptButton:"Challenge_acceptButton__2X5fa"}},87:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"LoginPage_background__2-RHP"}},88:function(e,t,a){e.exports={loadingContainer:"Loading_loadingContainer__vZjJV"}},89:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"ChallengesList_background__1Dy0t"}},91:function(e,t,a){e.exports={primaryLight:"#fff",primaryMain:"#e0e0e0",primaryDark:"#aeaeae",primaryText:"#000",secondaryLight:"#8d8d8d",secondaryMain:"#606060",secondaryDark:"#363636",secondaryText:"#fff",background:"TasksList_background__2Zchh"}}},[[106,1,2]]]);
//# sourceMappingURL=main.6071ef68.chunk.js.map